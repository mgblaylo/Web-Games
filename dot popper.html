<!DOCTYPE html>
<html>
<head>
    <title>Neon Swarm: Redux</title>
    <style>
        body { margin: 0; background: #050505; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        canvas { display: block; cursor: crosshair; }
        #ui { position: absolute; top: 20px; left: 20px; pointer-events: none; z-index: 5; }
        .stat { font-size: 20px; margin-bottom: 5px; text-shadow: 2px 2px #000; }
        
        #menu { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(15, 15, 25, 0.9); padding: 40px; border-radius: 20px; 
            text-align: center; border: 2px solid #00f2ff; box-shadow: 0 0 30px rgba(0, 242, 255, 0.2);
            z-index: 10;
        }
        h1 { color: #00f2ff; letter-spacing: 5px; margin-top: 0; }
        button { 
            display: block; width: 200px; padding: 12px; margin: 10px auto; 
            background: transparent; border: 2px solid #00f2ff; color: #00f2ff;
            font-weight: bold; border-radius: 5px; cursor: pointer; transition: 0.3s;
        }
        button:hover { background: #00f2ff; color: #000; box-shadow: 0 0 15px #00f2ff; }
        .easy { border-color: #2ecc71; color: #2ecc71; }
        .easy:hover { background: #2ecc71; color: #000; box-shadow: 0 0 15px #2ecc71; }
        .hard { border-color: #e74c3c; color: #e74c3c; }
        .hard:hover { background: #e74c3c; color: #000; box-shadow: 0 0 15px #e74c3c; }
    </style>
</head>
<body>
    <div id="ui">
        <div class="stat">Score: <span id="score">0</span></div>
        <div class="stat">Level: <span id="lvl">1</span></div>
    </div>

    <div id="menu">
        <h1 id="menu-title">NEON SWARM</h1>
        <p id="menu-msg">Select Difficulty to Begin</p>
        <button class="easy" onclick="startGame(1, 1000)">EASY</button>
        <button onclick="startGame(2, 700)">MEDIUM</button>
        <button class="hard" onclick="startGame(3.5, 400)">HARD</button>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const lvlEl = document.getElementById('lvl');
const menu = document.getElementById('menu');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player, enemies, bullets, score, level, gameActive = false;
let animationId, baseEnemySpeed, baseSpawnRate;
let mouse = { x: canvas.width/2, y: canvas.height/2 };

class Player {
    constructor() {
        this.x = canvas.width/2;
        this.y = canvas.height/2;
        this.radius = 15;
        this.color = '#00f2ff';
        this.speed = 4.5;
        this.fireRate = 12;
        this.timer = 0;
    }
    draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.shadowBlur = 15;
        ctx.shadowColor = this.color;
        ctx.fill();
        ctx.shadowBlur = 0;
    }
    update() {
        const dx = mouse.x - this.x;
        const dy = mouse.y - this.y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if(dist > 5) {
            this.x += (dx/dist) * this.speed;
            this.y += (dy/dist) * this.speed;
        }
        this.timer++;
        if(this.timer >= this.fireRate) {
            shoot();
            this.timer = 0;
        }
        this.draw();
    }
}

function shoot() {
    const angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
    bullets.push({
        x: player.x, y: player.y,
        vx: Math.cos(angle) * 12, vy: Math.sin(angle) * 12,
        radius: 4
    });
}

function spawnEnemy() {
    if(!gameActive) return;
    let x, y;
    if (Math.random() < 0.5) {
        x = Math.random() < 0.5 ? -30 : canvas.width + 30;
        y = Math.random() * canvas.height;
    } else {
        x = Math.random() * canvas.width;
        y = Math.random() < 0.5 ? -30 : canvas.height + 30;
    }
    // Difficulty scales with Level + Base Setting
    const speed = baseEnemySpeed + (level * 0.3);
    enemies.push({ x, y, radius: 12 + Math.random() * 8, speed: speed });
    
    setTimeout(spawnEnemy, Math.max(150, baseSpawnRate - (level * 40)));
}

function startGame(speedSetting, spawnSetting) {
    if (animationId) cancelAnimationFrame(animationId);
    gameActive = true;
    menu.style.display = 'none';
    
    baseEnemySpeed = speedSetting;
    baseSpawnRate = spawnSetting;
    
    player = new Player();
    enemies = []; bullets = [];
    score = 0; level = 1;
    scoreEl.innerText = score; 
    lvlEl.innerText = level;
    
    spawnEnemy();
    animate();
}

function animate() {
    if(!gameActive) return;
    animationId = requestAnimationFrame(animate);
    
    ctx.fillStyle = 'rgba(5, 5, 5, 0.25)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    player.update();

    bullets.forEach((b, i) => {
        b.x += b.vx; b.y += b.vy;
        ctx.fillStyle = '#fff';
        ctx.beginPath(); ctx.arc(b.x, b.y, b.radius, 0, Math.PI*2); ctx.fill();
        if(b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) bullets.splice(i, 1);
    });

    enemies.forEach((en, i) => {
        const dx = player.x - en.x;
        const dy = player.y - en.y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        en.x += (dx/dist) * en.speed;
        en.y += (dy/dist) * en.speed;
        
        ctx.fillStyle = '#ff3366';
        ctx.beginPath(); ctx.arc(en.x, en.y, en.radius, 0, Math.PI*2); ctx.fill();

        // Player Collision
        if(dist < en.radius + player.radius) {
            gameActive = false;
            menu.style.display = 'block';
            document.getElementById('menu-title').innerText = "GAME OVER";
            document.getElementById('menu-msg').innerText = "Final Score: " + score;
        }

        // Bullet Collision
        bullets.forEach((b, bi) => {
            const bDist = Math.hypot(b.x - en.x, b.y - en.y);
            if(bDist < en.radius + b.radius) {
                score += 10;
                scoreEl.innerText = score;
                if(score % 250 === 0) {
                    level++;
                    lvlEl.innerText = level;
                }
                enemies.splice(i, 1);
                bullets.splice(bi, 1);
            }
        });
    });
}

window.addEventListener('mousemove', (e) => { mouse.x = e.clientX; mouse.y = e.clientY; });
</script>
</body>
</html>