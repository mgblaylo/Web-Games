<!DOCTYPE html>
<html>
<head>
    <title>Star Jumper</title>
    <style>
        body { margin: 0; background: #050810; color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        canvas { display: block; }
        #menu { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(16, 33, 62, 0.95); padding: 40px; border-radius: 20px; text-align: center;
            border: 3px solid #4ecca3; box-shadow: 0 0 40px rgba(78, 204, 163, 0.2);
            min-width: 350px; z-index: 10;
        }
        button { 
            display: block; width: 100%; padding: 15px; margin-top: 20px; 
            background: #4ecca3; border: none; border-radius: 8px; cursor: pointer;
            font-weight: bold; font-size: 20px; color: #050810; transition: 0.2s;
        }
        button:hover { transform: scale(1.05); background: #45b78d; }
        #ui-layer { position: absolute; top: 20px; left: 20px; pointer-events: none; z-index: 5; width: 250px; }
        .stat-label { font-size: 12px; font-weight: bold; margin-bottom: 4px; color: #aaa; }
        .bar-container { width: 100%; height: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; margin-bottom: 15px; overflow: hidden; }
        .bar-fill { height: 100%; width: 100%; transition: width 0.1s linear; }
        #o2-bar { background: #3498db; }
        #fuel-bar { background: #f1c40f; }
        #score-display { font-size: 28px; font-weight: bold; margin-bottom: 5px; }
        #level-display { font-size: 16px; color: #4ecca3; font-weight: bold; margin-bottom: 10px; }
        .warning-flash { animation: blink 0.4s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }
    </style>
</head>
<body>
    <div id="ui-layer">
        <div id="score-display">SCORE: <span id="score">0</span></div>
        <div id="level-display">SECTOR: <span id="lvl">1</span></div>
        <div class="stat-label">O2 SUPPLY</div>
        <div class="bar-container"><div id="o2-bar" class="bar-fill"></div></div>
        <div class="stat-label">JET FUEL</div>
        <div class="bar-container"><div id="fuel-bar" class="bar-fill"></div></div>
    </div>
    
    <div id="menu">
        <h1 id="title" style="margin-top:0; color: #4ecca3;">STAR JUMPER</h1>
        <p id="msg">Climb higher to reach new sectors.</p>
        <button id="start-btn" onclick="startGame(0.35)">START MISSION</button>
    </div>
    <canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const lvlEl = document.getElementById('lvl');
const o2Bar = document.getElementById('o2-bar');
const fuelBar = document.getElementById('fuel-bar');
const menu = document.getElementById('menu');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let score, level, gameActive = false, platforms, player, gravityPower, keys, shake, animationId;

// Launch Function
function launchPlayer() {
    if (player.attachedTo && gameActive) {
        player.lastAttachedId = player.attachedTo.id;
        let side = player.attachedTo.rotSpeed > 0 ? 1 : -1;
        player.vx = Math.cos(player.angle + Math.PI/2 * side) * 13;
        player.vy = Math.sin(player.angle + Math.PI/2 * side) * 13;
        player.attachedTo = null;
    }
}

function startGame(g) {
    gameActive = false;
    if (animationId) cancelAnimationFrame(animationId);
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    gravityPower = g;
    menu.style.display = 'none';
    score = 0; level = 1;
    scoreEl.innerText = score;
    lvlEl.innerText = level;
    platforms = []; keys = {}; shake = 0;
    
    player = { 
        x: canvas.width/2, y: canvas.height-100, r: 10, 
        attachedTo: null, angle: 0, orbitDist: 55, 
        vx: 0, vy: 0, lastAttachedId: null,
        fuel: 100, o2: 5.0 
    };
    
    for(let i = 0; i < 10; i++) spawnPlatform(canvas.height - 100 - (i * 220), i === 0);
    player.attachedTo = platforms[0];
    
    gameActive = true;
    animate();
}

function spawnPlatform(y, isFirst) {
    const speedBoost = Math.min(0.08, level * 0.005);
    const hazardChance = Math.min(0.6, 0.15 + (level * 0.05));
    
    platforms.push({
        x: Math.random() * (canvas.width - 250) + 125,
        y: y, r: 35,
        rotSpeed: (Math.random() < 0.5 ? 1 : -1) * (0.04 + speedBoost + Math.random() * 0.02),
        isHazard: !isFirst && Math.random() < hazardChance,
        id: Math.random()
    });
}

function gameOver() {
    gameActive = false;
    if (animationId) cancelAnimationFrame(animationId);
    shake = 25;
    menu.style.display = 'block';
    document.getElementById('title').innerText = "MISSION FAILED";
    document.getElementById('title').style.color = "#ff4757";
    document.getElementById('start-btn').innerText = "RE-INITIALIZE";
}

function animate() {
    if(!gameActive) return;
    animationId = requestAnimationFrame(animate);
    
    ctx.fillStyle = '#050810';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    let camY = player.y - canvas.height / 2;
    
    ctx.save();
    if (shake > 0) { ctx.translate((Math.random()-0.5)*shake, (Math.random()-0.5)*shake); shake *= 0.9; }
    ctx.translate(0, -camY);

    if (player.attachedTo) {
        player.angle += player.attachedTo.rotSpeed;
        player.x = player.attachedTo.x + Math.cos(player.angle) * player.orbitDist;
        player.y = player.attachedTo.y + Math.sin(player.angle) * player.orbitDist;
        player.o2 = 5.0; 
        o2Bar.classList.remove("warning-flash");
    } else {
        player.o2 -= 0.016;
        if (player.o2 < 1.5) o2Bar.classList.add("warning-flash");
        if (player.o2 <= 0) { gameOver(); ctx.restore(); return; }

        if (player.fuel > 0) {
            let thrust = 0.45, used = false;
            if (keys['w'] || keys['arrowup']) { player.vy -= thrust; used = true; }
            if (keys['s'] || keys['arrowdown']) { player.vy += thrust; used = true; }
            if (keys['a'] || keys['arrowleft']) { player.vx -= thrust; used = true; }
            if (keys['d'] || keys['arrowright']) { player.vx += thrust; used = true; }
            if (used) {
                player.fuel -= 0.8;
                ctx.fillStyle = '#e67e22';
                ctx.beginPath(); ctx.arc(player.x, player.y + 8, 4, 0, Math.PI*2); ctx.fill();
            }
        }

        platforms.forEach(p => {
            if (player.lastAttachedId === p.id) return;
            let dx = p.x - player.x, dy = p.y - player.y, dist = Math.hypot(dx, dy);
            if (dist < 250) {
                player.vx += (dx / dist) * gravityPower;
                player.vy += (dy / dist) * gravityPower;
            }
        });

        player.x += player.vx; player.y += player.vy;
        player.vx *= 0.98; player.vy *= 0.98;
        if(player.y > (platforms[0]?.y || 0) + 600) { gameOver(); ctx.restore(); return; }
    }

    if (platforms[platforms.length - 1].y > player.y - 1000) {
        spawnPlatform(platforms[platforms.length - 1].y - 220, false);
    }
    if (platforms.length > 20) platforms.shift();

    o2Bar.style.width = (player.o2 / 5.0 * 100) + "%";
    fuelBar.style.width = player.fuel + "%";

    platforms.forEach((p) => {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        ctx.strokeStyle = p.isHazard ? '#ff4757' : '#4ecca3';
        ctx.lineWidth = 3;
        ctx.stroke();

        if (Math.hypot(player.x - p.x, player.y - p.y) < p.r + player.r) {
            if (p.isHazard) { gameOver(); return; }
            else if (!player.attachedTo) {
                player.attachedTo = p;
                player.lastAttachedId = null;
                player.fuel = Math.min(100, player.fuel + 35);
                player.angle = Math.atan2(player.y - p.y, player.x - p.x);
                score++; scoreEl.innerText = score;
                if (score % 5 === 0) { level++; lvlEl.innerText = level; }
            }
        }
    });

    ctx.beginPath(); ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
    ctx.fillStyle = (player.o2 < 1.5 && !player.attachedTo) ? '#ff4757' : '#fff'; 
    ctx.fill();
    ctx.restore();
}

// Controls
window.addEventListener('keydown', e => {
    keys[e.key.toLowerCase()] = true;
    if (e.code === 'Space') {
        e.preventDefault(); // Stop page from scrolling
        launchPlayer();
    }
});
window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
window.addEventListener('mousedown', (e) => {
    e.preventDefault();
    launchPlayer();
});
</script>
</body>
</html>